<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Home Counter -->
    <template id="portal_my_home_document" name="Show Documents" inherit_id="portal.portal_my_home" priority="30">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/sh_document_management/static/description/icon.png'"/>
                <t t-set="title">Documents</t>
                <t t-set="url" t-value="'/my/documents'"/>
                <t t-set="text">View shared documents</t>
                <t t-set="placeholder_count" t-value="'document_count'"/>
            </t>
        </xpath>
    </template>

    <!-- Main Documents Page -->
    <template id="portal_my_documents" name="My Documents">
        <t t-call="portal.portal_layout">
            <div class="doc-portal">
                <div class="doc-portal-content">
                    <!-- Page Header -->
                    <div class="doc-header">
                        <h1 class="doc-header-title">Documents</h1>
                        <p class="doc-header-subtitle">View and download your shared files</p>
                    </div>

                    <!-- Empty state when nothing shared -->
                    <t t-if="not directories and not files">
                        <div class="doc-empty-state">
                            <div class="doc-empty-state-icon">
                                <i class="fa fa-folder-o"></i>
                            </div>
                            <h3 class="doc-empty-state-title">No documents shared yet</h3>
                            <p class="doc-empty-state-text">When someone shares files with you, they'll appear here.</p>
                        </div>
                    </t>

                    <t t-else="">
                        <!-- Directories Section -->
                        <t t-if="directories">
                            <div class="doc-section-header">
                                <span class="doc-section-label">Directories</span>
                                <span class="doc-section-count"><t t-esc="len(directories)"/> items</span>
                            </div>

                            <div class="doc-directories-grid">
                                <t t-foreach="directories" t-as="directory">
                                    <a t-attf-href="/my/documents/directory/#{directory.id}" class="doc-directory-card">
                                        <div class="doc-directory-card-content">
                                            <i class="fa fa-folder doc-directory-icon"></i>
                                            <div class="doc-directory-info">
                                                <h4 class="doc-directory-name"><t t-esc="directory.name"/></h4>
                                                <span class="doc-directory-meta"><t t-esc="directory.file_count"/> files</span>
                                            </div>
                                        </div>
                                    </a>
                                </t>
                            </div>
                        </t>

                        <!-- Files Section -->
                        <t t-if="files">
                            <div class="doc-section-header">
                                <span class="doc-section-label">Files</span>
                                <span class="doc-section-count"><t t-esc="len(files)"/> items</span>
                            </div>

                            <div class="doc-files-list">
                                <div class="doc-files-header">
                                    <span class="doc-files-header-name">Name</span>
                                    <div class="doc-files-header-meta">
                                        <span>Type</span>
                                        <span>Date</span>
                                    </div>
                                </div>
                                <t t-foreach="files" t-as="file">
                                    <div class="doc-file-row">
                                        <t t-call="sh_document_management.file_icon_minimal">
                                            <t t-set="mimetype" t-value="file.mimetype"/>
                                        </t>
                                        <div class="doc-file-info">
                                            <span class="doc-file-name"><t t-esc="file.name"/></span>
                                        </div>
                                        <div class="doc-file-meta">
                                            <span class="doc-file-meta-item">
                                                <t t-esc="(file.mimetype or '').split('/')[-1].upper()[:6]"/>
                                            </span>
                                            <span class="doc-file-meta-item">
                                                <t t-esc="file.create_date.strftime('%b %d')"/>
                                            </span>
                                        </div>
                                        <div class="doc-file-actions">
                                            <t t-call="sh_document_management.file_actions_minimal">
                                                <t t-set="file" t-value="file"/>
                                            </t>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </t>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Directory Content Page -->
    <template id="portal_directory_content" name="Directory Content">
        <t t-call="portal.portal_layout">
            <div class="doc-portal">
                <div class="doc-portal-content">
                    <!-- Breadcrumb -->
                    <nav class="doc-breadcrumb">
                        <a href="/my/documents" class="doc-breadcrumb-item">Documents</a>
                        <t t-foreach="breadcrumb" t-as="bc">
                            <span class="doc-breadcrumb-separator">/</span>
                            <t t-if="bc.id == directory.id">
                                <span class="doc-breadcrumb-item current"><t t-esc="bc.name"/></span>
                            </t>
                            <t t-else="">
                                <a t-attf-href="/my/documents/directory/#{bc.id}" class="doc-breadcrumb-item">
                                    <t t-esc="bc.name"/>
                                </a>
                            </t>
                        </t>
                    </nav>

                    <!-- Directory Header -->
                    <div class="doc-directory-header">
                        <h2 class="doc-directory-title"><t t-esc="directory.name"/></h2>
                        <a t-attf-href="/my/documents/directory/#{directory.id}/download" class="doc-btn-primary">
                            <i class="fa fa-download"></i>
                            Download All
                        </a>
                    </div>

                    <!-- Sub-directories -->
                    <t t-if="sub_directories">
                        <div class="doc-section-header">
                            <span class="doc-section-label">Subdirectories</span>
                            <span class="doc-section-count"><t t-esc="len(sub_directories)"/> items</span>
                        </div>

                        <div class="doc-directories-grid">
                            <t t-foreach="sub_directories" t-as="subdir">
                                <a t-attf-href="/my/documents/directory/#{subdir.id}" class="doc-directory-card">
                                    <div class="doc-directory-card-content">
                                        <i class="fa fa-folder doc-directory-icon"></i>
                                        <div class="doc-directory-info">
                                            <h4 class="doc-directory-name"><t t-esc="subdir.name"/></h4>
                                            <span class="doc-directory-meta"><t t-esc="subdir.file_count"/> files</span>
                                        </div>
                                    </div>
                                </a>
                            </t>
                        </div>
                    </t>

                    <!-- Files in directory -->
                    <div class="doc-section-header">
                        <span class="doc-section-label">Files</span>
                        <span class="doc-section-count"><t t-esc="len(files)"/> items</span>
                    </div>

                    <t t-if="files">
                        <div class="doc-files-list">
                            <div class="doc-files-header">
                                <span class="doc-files-header-name">Name</span>
                                <div class="doc-files-header-meta">
                                    <span>Type</span>
                                    <span>Size</span>
                                    <span>Date</span>
                                </div>
                            </div>
                            <t t-foreach="files" t-as="file">
                                <div class="doc-file-row">
                                    <t t-call="sh_document_management.file_icon_minimal">
                                        <t t-set="mimetype" t-value="file.mimetype"/>
                                    </t>
                                    <div class="doc-file-info">
                                        <span class="doc-file-name"><t t-esc="file.name"/></span>
                                    </div>
                                    <div class="doc-file-meta">
                                        <span class="doc-file-meta-item">
                                            <t t-esc="(file.mimetype or '').split('/')[-1].upper()[:6]"/>
                                        </span>
                                        <span class="doc-file-meta-item">
                                            <t t-if="file.file_size >= 1048576">
                                                <t t-esc="round(file.file_size / 1048576, 1)"/> MB
                                            </t>
                                            <t t-else="">
                                                <t t-esc="round(file.file_size / 1024, 1)"/> KB
                                            </t>
                                        </span>
                                        <span class="doc-file-meta-item">
                                            <t t-esc="file.create_date.strftime('%b %d')"/>
                                        </span>
                                    </div>
                                    <div class="doc-file-actions">
                                        <t t-call="sh_document_management.file_actions_minimal">
                                            <t t-set="file" t-value="file"/>
                                        </t>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="doc-empty-inline">This directory is empty</div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- File Icon Helper Template (Minimal) -->
    <template id="file_icon_minimal" name="File Icon Minimal">
        <t t-if="mimetype and 'pdf' in mimetype">
            <i class="fa fa-file-pdf-o doc-file-icon pdf"></i>
        </t>
        <t t-elif="mimetype and 'image' in mimetype">
            <i class="fa fa-file-image-o doc-file-icon image"></i>
        </t>
        <t t-elif="mimetype and ('word' in mimetype or 'document' in mimetype)">
            <i class="fa fa-file-word-o doc-file-icon word"></i>
        </t>
        <t t-elif="mimetype and ('excel' in mimetype or 'spreadsheet' in mimetype)">
            <i class="fa fa-file-excel-o doc-file-icon excel"></i>
        </t>
        <t t-elif="mimetype and ('powerpoint' in mimetype or 'presentation' in mimetype)">
            <i class="fa fa-file-powerpoint-o doc-file-icon ppt"></i>
        </t>
        <t t-elif="mimetype and 'text' in mimetype">
            <i class="fa fa-file-text-o doc-file-icon text"></i>
        </t>
        <t t-elif="mimetype and 'zip' in mimetype">
            <i class="fa fa-file-archive-o doc-file-icon archive"></i>
        </t>
        <t t-else="">
            <i class="fa fa-file-o doc-file-icon default"></i>
        </t>
    </template>

    <!-- File Actions Helper Template (Minimal) -->
    <template id="file_actions_minimal" name="File Actions Minimal">
        <!-- Preview button for supported formats -->
        <t t-set="previewable" t-value="file.mimetype and ('pdf' in file.mimetype or 'image' in file.mimetype or 'text/plain' in file.mimetype)"/>
        <t t-if="previewable">
            <a t-attf-href="/my/documents/file/#{file.id}/preview"
               class="doc-btn-icon" target="_blank" title="Preview">
                <i class="fa fa-eye"></i>
            </a>
        </t>
        <!-- Download button -->
        <a t-attf-href="/my/documents/file/#{file.id}/download"
           class="doc-btn-icon" title="Download">
            <i class="fa fa-download"></i>
        </a>
    </template>

    <!-- Keep old templates for backwards compatibility (hidden) -->
    <template id="file_icon" name="File Icon (Legacy)">
        <t t-call="sh_document_management.file_icon_minimal">
            <t t-set="mimetype" t-value="mimetype"/>
        </t>
    </template>

    <template id="file_actions" name="File Actions (Legacy)">
        <t t-call="sh_document_management.file_actions_minimal">
            <t t-set="file" t-value="file"/>
        </t>
    </template>

</odoo>
